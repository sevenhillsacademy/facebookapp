This code is updatd from dev branch

